<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Test natijalari</title>

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}

body{
  margin:0;
  min-height:100vh;
  background:#ecfdf5;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:30px;
}

.container{
  width:100%;
  max-width:1100px;
  background:#ffffff;
  padding:35px;
  border-radius:22px;
  border:2px solid #e5e7eb;
  box-shadow:0 25px 50px rgba(0,0,0,0.15);
}

h1{
  text-align:center;
  margin-top:0;
}

.actions{
  display:flex;
  justify-content:center;
  gap:15px;
  margin-bottom:25px;
}

.actions button{
  padding:12px 18px;
  font-weight:bold;
  border:none;
  border-radius:10px;
  cursor:pointer;
  background:#4f46e5;
  color:white;
}

/* SUMMARY */
.summary{
  text-align:center;
  padding:30px;
  border-radius:18px;
  margin-bottom:30px;
}

.red{background:#fee2e2}
.orange{background:#ffedd5}
.yellow{background:#fef9c3}
.blue{background:#dbeafe}

.big{
  font-size:40px;
  font-weight:bold;
}

.user{
  font-size:20px;
  margin-bottom:10px;
}

.time{
  margin-top:10px;
  color:#374151;
}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}

th,td{
  border:1px solid #e5e7eb;
  padding:12px;
  text-align:center;
}

th{
  background:#f3f4f6;
}

tr:nth-child(even){
  background:#f9fafb;
}

.low{color:#dc2626;font-weight:bold}
.mid{color:#d97706;font-weight:bold}
.high{color:#16a34a;font-weight:bold}
</style>
</head>
<body>

<div class="container">
  <h1>ðŸ“Š Test natijalari</h1>

  <div class="actions">
    <button onclick="exportExcel()">ðŸ“¥ Excel yuklash</button>
    <button onclick="exportPDF()">ðŸ“„ PDF yuklash</button>
  </div>

  <!-- OXIRGI NATIJA -->
  <div id="summary"></div>

  <h2>ðŸ“‹ Barcha natijalar</h2>

  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Ism</th>
        <th>Familiya</th>
        <th>Test ID</th>
        <th>Ball</th>
        <th>Tugagan vaqt</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>
</div>

<script>
const results = JSON.parse(localStorage.getItem("results")) || [];
const summary = document.getElementById("summary");
const rows = document.getElementById("rows");

if(results.length === 0){
  summary.innerHTML = "<b>Natijalar mavjud emas</b>";
}else{
  const last = results[results.length-1];
  const ball = last.ball;

  let cls="red", text="Attestatsiya Mock testidan oâ€˜tmadi";
  if(ball >= 80){
    cls="blue"; text="Oliy toifa balini toâ€˜pladingiz";
  }else if(ball >= 70){
    cls="yellow"; text="Birinchi toifa balini toâ€˜pladingiz";
  }else if(ball >= 60){
    cls="orange"; text="Ikkinchi toifa balini toâ€˜pladingiz";
  }

  summary.innerHTML = `
    <div class="summary ${cls}">
      <div class="user">${last.ism} ${last.familiya}</div>
      <div class="big">${ball}/100</div>
      <div>${text}</div>
      <div class="time">Test tugagan vaqt: ${last.endTime}</div>
    </div>
  `;

  results.forEach((r,i)=>{
    let scoreCls = r.ball >= 80 ? "high" : r.ball >= 60 ? "mid" : "low";
    rows.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td>${r.ism}</td>
        <td>${r.familiya}</td>
        <td>${r.testId}</td>
        <td class="${scoreCls}">${r.ball}</td>
        <td>${r.endTime}</td>
      </tr>
    `;
  });
}
</script>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
function exportExcel(){
  if(results.length === 0){ alert("Natija yoâ€˜q"); return; }

  const sheetData = results.map(r=>({
    Ism:r.ism,
    Familiya:r.familiya,
    TestID:r.testId,
    Ball:r.ball,
    Tugagan_vaqt:r.endTime
  }));

  const ws = XLSX.utils.json_to_sheet(sheetData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Natijalar");
  XLSX.writeFile(wb, "natijalar.xlsx");
}
</script>

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
function exportPDF(){
  if(results.length === 0){ alert("Natija yoâ€˜q"); return; }

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  pdf.text("Attestatsiya Mock Test Natijalari", 10, 10);
  let y = 20;

  results.forEach((r,i)=>{
    pdf.text(
      `${i+1}) ${r.ism} ${r.familiya} â€” ${r.ball}/100`,
      10, y
    );
    y += 8;
  });

  pdf.save("natijalar.pdf");
}
</script>

</body>
</html>
