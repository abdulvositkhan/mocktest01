<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>Admin â€” Test yaratish</title>

<style>
/* DIZAYN Oâ€˜ZGARMADI */
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(90deg,#4f6bd8,#2db67c);
}

.container {
    max-width: 900px;
    margin: 30px auto;
    background: #fff;
    border-radius: 18px;
    padding: 25px;
}
input, select, button {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    margin-bottom: 10px;
}
.question-box {
    border: 1px dashed #ccc;
    padding: 15px;
    border-radius: 10px;
}
.test-item {
    display:flex;
    justify-content:space-between;
    margin-top:10px;
}
.test-item button {
    width:auto;
}
</style>
</head>

<body>

<div class="container">

<h2>ğŸ›  Test yaratish / tahrirlash</h2>

<input id="testId" placeholder="Test ID">
<input id="duration" type="number" placeholder="Davomiylik (daq)">

<hr>

<h3>ğŸ“‚ Excel orqali savol yuklash (ixtiyoriy)</h3>
<input type="file" id="excelFile">

<hr>

<h3>âœ Qoâ€˜lda savol qoâ€˜shish</h3>

<div class="question-box">

<input id="qText" placeholder="Savol matni">

<input id="imgUrl" placeholder="Rasm URL (ixtiyoriy)">
<input type="file" id="imgFile">

<input id="a" placeholder="A variant">
<input id="b" placeholder="B variant">
<input id="c" placeholder="C variant">
<input id="d" placeholder="D variant">

<select id="correct">
  <option value="">Toâ€˜gâ€˜ri javob</option>
  <option>A</option>
  <option>B</option>
  <option>C</option>
  <option>D</option>
</select>

<button onclick="addQuestion()">Savol qoâ€˜shish</button>

<p>Savollar: <span id="count">0</span>/50</p>

</div>

<button onclick="saveTest()">TESTNI SAQLASH</button>

<hr>

<h3>ğŸ“‹ Mavjud testlar</h3>
<div id="tests"></div>

</div>

<script>
let questions = [];
let editingIndex = null;

/* RASMNI BASE64 QILISH */
function getImageBase64(file, cb) {
    const reader = new FileReader();
    reader.onload = () => cb(reader.result);
    reader.readAsDataURL(file);
}

/* SAVOL QOâ€˜SHISH */
function addQuestion() {
    if (questions.length >= 50) return alert("50 ta savol yetarli");

    const q = {
        text: qText.value,
        img: null,
        options: {
            A: a.value,
            B: b.value,
            C: c.value,
            D: d.value
        },
        correct: correct.value
    };

    if (imgFile.files.length) {
        getImageBase64(imgFile.files[0], img => {
            q.img = img;
            pushQuestion(q);
        });
    } else {
        q.img = imgUrl.value || null;
        pushQuestion(q);
    }
}

function pushQuestion(q) {
    if (editingIndex !== null) {
        questions[editingIndex] = q;
        editingIndex = null;
    } else {
        questions.push(q);
    }
    resetForm();
}

function resetForm() {
    qText.value = imgUrl.value = a.value = b.value = c.value = d.value = "";
    imgFile.value = "";
    correct.value = "";
    count.innerText = questions.length;
}

/* TESTNI SAQLASH */
function saveTest() {
    const tests = JSON.parse(localStorage.getItem("tests") || "[]");

    tests.push({
        id: testId.value,
        duration: duration.value,
        questions
    });

    localStorage.setItem("tests", JSON.stringify(tests));
    alert("Test saqlandi");
    questions = [];
    count.innerText = 0;
    loadTests();
}

/* TESTLARNI CHIQARISH */
function loadTests() {
    tests.innerHTML = "";
    const data = JSON.parse(localStorage.getItem("tests") || "[]");

    data.forEach((t,i)=>{
        tests.innerHTML += `
        <div class="test-item">
            <b>${t.id}</b>
            <div>
              <button onclick="editTest(${i})">âœ</button>
              <button onclick="deleteTest(${i})">âŒ</button>
            </div>
        </div>`;
    });
}

/* TAHRIRLASH */
function editTest(i) {
    const data = JSON.parse(localStorage.getItem("tests"));
    const t = data[i];

    testId.value = t.id;
    duration.value = t.duration;
    questions = t.questions;
    count.innerText = questions.length;

    alert("Endi savollarni oâ€˜zgartirib qayta saqlang");
}

/* Oâ€˜CHIRISH */
function deleteTest(i) {
    const data = JSON.parse(localStorage.getItem("tests"));
    data.splice(i,1);
    localStorage.setItem("tests",JSON.stringify(data));
    loadTests();
}

loadTests();
</script>

</body>
</html>
