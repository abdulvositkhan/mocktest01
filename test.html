<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Test topshirish</title>

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}

body{
  margin:0;
  min-height:100vh;
  background:#ecfdf5;
  display:flex;
  justify-content:center;
  align-items:center;
}

.container{
  width:100%;
  max-width:900px;
  background:#ffffff;
  padding:30px;
  border-radius:20px;
  border:2px solid #e5e7eb;
  box-shadow:0 25px 50px rgba(0,0,0,0.15);
}

.timer{
  position:fixed;
  top:20px;
  right:20px;
  background:#dc2626;
  color:#fff;
  padding:14px 20px;
  border-radius:14px;
  font-size:20px;
  font-weight:bold;
}

.question-box{
  border:2px solid #e5e7eb;
  border-radius:16px;
  padding:25px;
  font-size:22px;
  font-weight:600;
  margin-bottom:20px;
  background:#f0fdf4;
}

.question-box img{
  max-width:100%;
  margin-top:15px;
  border-radius:12px;
}

.option{
  border:2px solid #e5e7eb;
  border-radius:12px;
  padding:14px;
  margin-top:12px;
  cursor:pointer;
  font-size:18px;
}

.option:hover{
  background:#ecfeff;
}

.option.selected{
  background:#dbeafe;
  border-color:#2563eb;
}

.nav{
  display:flex;
  justify-content:space-between;
  margin-top:25px;
}

button{
  padding:14px 24px;
  font-size:16px;
  font-weight:bold;
  border:none;
  border-radius:12px;
  cursor:pointer;
  background:#4f46e5;
  color:white;
}

.finish{
  width:100%;
  margin-top:25px;
  background:#16a34a;
}
</style>
</head>
<body>

<div class="timer" id="timer"></div>

<div class="container">
  <div id="testArea">
    <div class="question-box" id="qBox"></div>
    <div id="options"></div>

    <div class="nav">
      <button onclick="prev()">⬅ Oldingi</button>
      <button onclick="next()">Keyingi ➡</button>
    </div>

    <button class="finish" id="finishBtn" onclick="finish()" style="display:none">
      TESTNI YAKUNLASH
    </button>
  </div>
</div>

<script>
const testId = localStorage.getItem("currentTestId");
const user = JSON.parse(localStorage.getItem("currentUser"));
const allTests = JSON.parse(localStorage.getItem("allTests")) || {};
const test = allTests[testId];

if(!test){
  alert("Test topilmadi");
  location.href="taker.html";
}

let index = 0;
let answers = {};
let timeLeft = test.duration * 60;

setInterval(()=>{
  const m = Math.floor(timeLeft/60);
  const s = timeLeft%60;
  timer.innerText = `⏱ ${m}:${String(s).padStart(2,"0")}`;
  timeLeft--;
  if(timeLeft < 0) finish();
},1000);

<script>
function yakunla() {
  const answers = {
    q1: "B",
    q2: "C",
    q3: "B",
    q4: "C",
    q5: "B"
  };

  let togri = 0;
  let jamiSavol = Object.keys(answers).length;

  for (let q in answers) {
    let tanlangan = document.querySelector(`input[name="${q}"]:checked`);
    if (tanlangan && tanlangan.value === answers[q]) {
      togri++;
    }
  }

  let ball = togri * 2;
  let rang = "";
  let matn = "";

  if (ball < 60) {
    rang = "red";
    matn = "Attestatsiya Mock testdan o‘tilmadi";
  } else if (ball <= 69) {
    rang = "orange";
    matn = "Ikkinchi toifa balini to‘pladingiz";
  } else if (ball <= 79) {
    rang = "yellow";
    matn = "Birinchi toifa balini to‘pladingiz";
  } else {
    rang = "blue";
    matn = "Oliy toifa balini to‘pladingiz";
  }

  document.getElementById("natija").innerHTML = `
    <div class="result ${rang}">
      <p>Natija: ${ball} / ${jamiSavol*2}</p>
      <p>${matn}</p>
      <p>To‘g‘ri javoblar: ${togri} / ${jamiSavol}</p>
    </div>
  `;
}
</script>
function finish(){
  let correct = 0;
  test.questions.forEach((q,i)=>{
    if(answers[i] === q.correct) correct++;
  });

  const ball = correct * 2;
  const endTime = new Date().toLocaleString();

  const results = JSON.parse(localStorage.getItem("results")) || [];
  results.push({
    ism:user.ism,
    familiya:user.familiya,
    testId:testId,
    ball:ball,
    answers:answers,
    questions:test.questions,
    endTime:endTime
  });

  localStorage.setItem("results",JSON.stringify(results));
  location.href="results.html";
}
</script>

</body>
</html>

